# Cursor AI Rules for TimTracker2

## Project Context

Next.js 14 App Router with Clerk auth, Neon PostgreSQL, TypeScript, deployed on Vercel.

For environment variables, see `README.md`.

## Code Style

- TypeScript strict mode
- Server components by default; `'use client'` only when needed
- Functional components with TypeScript interfaces for props

## File Conventions

- Pages: `app/[route]/page.tsx`
- API Routes: `app/api/[route]/route.ts`
- Layouts: `app/[route]/layout.tsx`
- Utilities: `lib/[utility].ts`

## Authentication Patterns

- **Route Protection**: Check `middleware.ts` before adding routes
- **Public Routes**: Add to `isPublicRoute` matcher in `middleware.ts`

### Server Component / API Route
```typescript
import { auth } from '@clerk/nextjs/server';

const { userId } = await auth();
if (!userId) {
  return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
}
```

### Client Component
```typescript
'use client';
import { useAuth } from '@clerk/nextjs';

const { userId, isLoaded } = useAuth();
```

## Database Pattern

```typescript
import { getPool } from '@/lib/db';

const pool = getPool();
const result = await pool.query('SELECT * FROM table_name LIMIT 10');
```

## API Route Template

```typescript
// app/api/[route]/route.ts
import { auth } from '@clerk/nextjs/server';
import { NextResponse } from 'next/server';
import { getPool } from '@/lib/db';

export async function GET() {
  const { userId } = await auth();
  if (!userId) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }
  
  const pool = getPool();
  const result = await pool.query('SELECT * FROM table_name LIMIT 10');
  return NextResponse.json({ data: result.rows });
}
```

## When Adding Features

1. Check existing patterns in the codebase
2. Update `middleware.ts` if adding routes
3. Create PRD in `docs/PRDs/` for major features
4. Update `ARCHITECTURE.md` for architectural changes

## Error Handling

- Try-catch in async functions
- Appropriate HTTP status codes
- User-friendly error messages

## Performance

- Use Next.js Image component
- React Suspense for async components
- Check bundle size on imports
